<script>

    $(function(){
        var component_ID = {
            type: "tab",
            demo: true,
            version: 1.0,
            kind: "component",
            name: "material-tab.html",
            description: "creates outfit material in zangoDB.",
        };
    });

</script>

<style>

    .selected {
        box-shadow: inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(0, 142, 255, 1);
    }

    .material-title-field {
        color:#ffffff;
        background:none;
    }

    .material-value {
        text-align: center;
        font-size: x-large;
        font-weight: bold;
    }
    
    .material-textfield {
        width:70%;
        float:right;
    }

    .x-large {
        font-size: x-large;
    }
    
    .material-property-controls {
        height:40px;
    }

    .material-textfield {
        width:75%;
    }

    .material-checkbox {
        width:34px;
    }

    .material-input-number {
        width: 45px;
        padding: 0;
        text-align: right;
        background: none;
        font-weight: bold;
        font-size: 18px;
        border: none;
        color: #ffff;
    }

    #property-controls{
        background:none;
        border-radius:8px;
    }

    .catalog-item {
        width:85px;
        height:85px;
        margin:4px;
        background-size: contain;
        background-position:50% 50%;
        background-repeat:no-repeat;
    }

</style>

<div class="helpers-header material-header" style="margin-bottom:20px;">
    <input type="text" id="material-name" class="form-control text-center x-large material-title-field" placeholder="material name">
</div>

<div style="height:35px;margin-bottom:10px;">
    <h4><span style="vertical-align:-0.5rem;">Select gender:</span>
        <div style="width:40%;display:inline-block;float:right;">
            <select id="material-gender-droplist" class="form-control gender droplist" readOnly>
                <option value="">Select sex:</option>
                <option value="/gender/male">male</option>
                <option value="/gender/female">female</option>
            </select>
        </div>
    </h4>
</div>

<script>

(function(){

    const viewer = document.getElementById("viewer");
    const droplist = document.getElementById("material-gender-droplist");
    const outfitHelpersTabSelector = ".outfit-helpers.component-pane.tab-pane";
    const maleOutfitHelpersSelector = "#male-outfit-helpers";
    const femaleOutfitHelpersSelector = "#female-outfit-helpers";

    var Signal = signals.Signal;
    var genderChanged = new Signal();

    genderChanged.add(function(data){
    //  Send data localy.
        viewer.contentWindow.localPlayerHandler(data);
    });

    $(droplist).on("change", function(){
        genderChanged.dispatch( this.value );
        if (this.value) store( "Sex", this.value );
    });

})();

</script>

<div style="height:35px;margin-bottom:10px;">
    <h4><span style="vertical-align:-0.5rem;">Select outfit slot:</span>
        <div style="width:40%;display:inline-block;float:right;">
            <select id="outifit-slot" class="form-control outfit-slot-droplist" readOnly>
                <option value="">Select slot:</option>
                <option value="/select/body">body</option>
                <option value="/select/eyes">eyes</option>
                <option value="/select/hairs">hairs</option>
                <option value="/select/stockings">stockings</option>
                <option value="/select/underwears">underwears</option>
                <option value="/select/costume">costume</option>
                <option value="/select/tshirt">tshirt</option>
                <option value="/select/trousers">trousers</option>
                <option value="/select/dress">dress</option>
                <option value="/select/shoes">shoes</option>
            </select>
        </div>
    </h4>
</div>

<script>

(function(){

    const viewer = document.getElementById("viewer");
    const droplist = $("select#outifit-slot").get(0);

    var Signal = signals.Signal;
    var outfitSlotChanged = new Signal();

    outfitSlotChanged.add(function(data){
    //  Send data localy.
        viewer.contentWindow.outfitSelectHandler(data);
    });

    $(droplist).on("change", function(){
        if (!this.value) return;
        outfitSlotChanged.dispatch(this.value);
    });

})();

</script>



<div style="height:35px;margin-bottom:10px;">
    <h4><span style="vertical-align:-0.5rem;">Select material type:</span>
        <div style="width:40%;display:inline-block;float:right;">
            <select id="material-type" class="form-control material-type-droplist" readOnly>
                <option value="MeshStandardMaterial">standard</option>
                <option value="MeshPhongMaterial">phong</option>
                <option value="MeshLambertMaterial">lambert</option>
                <option value="MeshBasicMaterial">basic</option>
            </select>
        </div>
    </h4>
</div>

<div style="height:35px;margin-bottom:10px;">
    <h4><span style="vertical-align:-0.5rem;">Select property:</span>
        <div style="width:40%;display:inline-block;float:right;">
            <select id="material-property" class="form-control material-property-droplist" readOnly>
                <option value="">Select key:</option>
            </select>
        </div>
    </h4>
</div>

<div id="property-controls" class="well fade in active"></div>


<script>

(function(){

    const viewer = document.getElementById("viewer");
    const propControls = document.getElementById("property-controls");
    const typeDroplist = $("select#material-type").get(0);
    const propDroplist = $("select#material-property").get(0);

    function updateMaterialPropertiesDroplist(){

        var TYPE = $(typeDroplist).val();
        var material = new THREE[ TYPE ]();
        var json = materialtoJSON(material);
        debugMode && console.log({"json":json});

        $(propDroplist).off();                // important!
        $(propDroplist).children().remove();  // important!
        $(propControls).children().remove();      // important!

        for ( var key in json ) {

            if ( key == undefined ) return;
            debugMode && console.log({[key]:typeof(json[key])});

            var option = $(`<option id="${key}" value="${json[key]}">${key}</option>`).get(0);

            $(propDroplist).append(option);

        }

        $(propDroplist).on("change", function(){

            var key = $(this.selectedOptions[0]).text();
            debugMode && console.log({[key]:this.value});

            $(propControls).children().remove(); // important!

            if (typeof( json[key] ) == "string") {

                var element = $(
                `<h4 id="property-${key}" class="material-property-controls">
                    <span style="vertical-align:-0.7rem;">${key}:</span>
                    <input id="${key}-field" type="text" class="form-control pull-right material-textfield" value="${json[key]}">
                </h4>`).get(0);

                var input = $(element).find(`input#${key}-field`).get(0);
                $(input).on("input", function(){
                    $(propDroplist).find(`option#${key}`).val( this.value );
                });

            } else if (typeof( json[key] ) == "number") {

                var element = $(
                `<h4 id="property-${key}" class="material-property-controls">
                    <span style="vertical-align:-0.7rem;">${key}:</span>
                    <input id="${key}-field" type="number" class="form-control pull-right material-input-number">
                </h4>`).get(0);

                var input = $(element).find(`input#${key}-field`).get(0);
                input.value = json[key];

                $(input).on("input", function(){
                    $(propDroplist).find(`option#${key}`).val( this.value );
                });

            } else if (typeof( json[key] ) == "boolean") {

                var element = $(
                `<h4 id="property-${key}" class="material-property-controls">
                    <span style="vertical-align:-0.7rem;">${key}:</span>
                    <input id="${key}-field" type="checkbox" class="form-control pull-right material-checkbox">
                </h4>`).get(0);
                
                var input = $(element).find(`input#${key}-field`).get(0);
                input.checked = json[key];

                $(input).on("click", function(){
                    $(propDroplist).find(`option#${key}`).val( this.checked );
                });

            }

            debugMode && console.log(input);

            $(propControls).append(element);

        });

         $(propDroplist).change();

    }

    function initMaterialPropertiesDroplist(){

        $(typeDroplist).on("change", function(){
            updateMaterialPropertiesDroplist();
        });

        updateMaterialPropertiesDroplist();

    }

    var dependences = [
        "/three/three.js", 
        "/material/materialtoJson.js"
    ];

    loadjs(dependences, {
        async: false,
        success: initMaterialPropertiesDroplist,
    });


})();

</script>







<div id="save-material" class="form-control btn btn-info btn-white-outline gradient-btn" style="margin-bottom:10px;">Save</div>

<script>

    $("#save-material").on("click", function(){
        var TYPE = $("select#material-type").val();
        MATERIAL = new THREE[ TYPE ]();
        debugMode && console.log({"material":materialtoJSON(MATERIAL)})
    });

</script>


<!--
    <h4 id="property_id" class="material-property-controls">
        <div id="_id-button" class="form-control btn btn-info btn-white-outline gradient-btn" style="width:fit-content;">_ID</div>
        <input id="_id-field" type="text" class="form-control pull-right material-textfield" readOnly>
    </h4>

    <script>
        (function(){
            $("#_id-button").on("click", function(){
                var value = ObjectId();
                $("input#_id-field").val( value );
                $("select#material-property").find("option#_id").val( value );
            });
        })();
    </script>

    <h4 id="property_uuid" class="material-property-controls">
        <div id="uuid-button" class="form-control btn btn-info btn-white-outline gradient-btn" style="width:fit-content;">UUID</div>
        <input id="uuid-field" type="text" class="form-control pull-right material-textfield" readOnly>
    </h4>

    <script>
        (function(){
            $("#uuid-button").on("click", function(){
                var value = THREE.Math.generateUUID();
                $("input#uuid-field").val( value );
                $("select#material-property").find("option#uuid").val( value );
            });
        })();
    </script>

    <h4 id="property_name" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">name:</span>
        <input id="name-field" type="text" class="form-control pull-right material-textfield">
    </h4>

    <h4 id="property_type" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">type:</span>
        <input id="type-field" type="text" class="form-control pull-right material-textfield" readOnly>
    </h4>

    <h4 id="property_fog" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">fog:</span>
        <input id="fog-field" type="checkbox" class="form-control pull-right material-checkbox">
    </h4>

    <h4 id="property_lights" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">lights:</span>
        <input id="lights-field" type="checkbox" class="form-control pull-right material-checkbox">
    </h4>

    <h4 id="property_blending" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">blending:</span>
        <input id="blending-field" type="number" class="form-control pull-right material-input-number" value="0">
    </h4>

    <h4 id="property_side" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">side:</span>
        <input id="side-field" type="number" class="form-control pull-right material-input-number" value="0">
    </h4>

    <h4 id="property_shading" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">shading:</span>
        <input id="shading-field" type="number" class="form-control pull-right material-input-number" value="0">
    </h4>

    <h4 id="property_vertexColors" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">vertexColors:</span>
        <input id="vertexColors-field" type="number" class="form-control pull-right material-input-number" value="0">
    </h4>

    <h4 id="property_opacity" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">opacity:</span>
        <input id="opacity-field" type="number" class="form-control pull-right material-input-number" value="0">
    </h4>

    <h4 id="property_transparent" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">transparent:</span>
        <input id="transparent-field" type="checkbox" class="form-control pull-right material-checkbox">
    </h4>

    <h4 id="property_blendSrc" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">blendSrc:</span>
        <input id="blendSrc-field" type="number" class="form-control pull-right material-input-number" value="0">
    </h4>

    <h4 id="property_blendDst" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">blendDst:</span>
        <input id="blendDst-field" type="number" class="form-control pull-right material-input-number" value="0">
    </h4>

    <h4 id="property_blendEquation" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">blendEquation:</span>
        <input id="blendEquation-field" type="number" class="form-control pull-right material-input-number" value="0">
    </h4>

    <h4 id="property_depthFunc" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">depthFunc:</span>
        <input id="depthFunc-field" type="number" class="form-control pull-right material-input-number" value="0">
    </h4>

    <h4 id="property_depthTest" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">depthTest:</span>
        <input id="depthTest-field" type="checkbox" class="form-control pull-right material-checkbox">
    </h4>

    <h4 id="property_depthWrite" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">depthWrite:</span>
        <input id="depthWrite-field" type="checkbox" class="form-control pull-right material-checkbox">
    </h4>

    <h4 id="property_clipShadows" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">clipShadows:</span>
        <input id="clipShadows-field" type="checkbox" class="form-control pull-right material-checkbox">
    </h4>

    <h4 id="property_colorWrite" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">colorWrite:</span>
        <input id="colorWrite-field" type="checkbox" class="form-control pull-right material-checkbox">
    </h4>

    <h4 id="property_polygonOffset" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">polygonOffset:</span>
        <input id="polygonOffset-field" type="checkbox" class="form-control pull-right material-checkbox">
    </h4>

    <h4 id="property_polygonOffsetFactor" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">polygonOffsetFactor:</span>
        <input id="polygonOffsetFactor-field" type="number" class="form-control pull-right material-input-number" value="0">
    </h4>

    <h4 id="property_polygonOffsetUnits" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">polygonOffsetUnits:</span>
        <input id="polygonOffsetUnits-field" type="number" class="form-control pull-right material-input-number" value="0">
    </h4>

    <h4 id="property_alphaTest" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">alphaTest:</span>
        <input id="alphaTest-field" type="number" class="form-control pull-right material-input-number" value="0">
    </h4>

    <h4 id="property_premultipliedAlpha" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">premultipliedAlpha:</span>
        <input id="premultipliedAlpha-field" type="checkbox" class="form-control pull-right material-checkbox">
    </h4>

    <h4 id="property_overdraw" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">overdraw:</span>
        <input id="overdraw-field" type="number" class="form-control pull-right material-input-number" value="0">
    </h4>

    <h4 id="property_visible" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">visible:</span>
        <input id="visible-field" type="checkbox" class="form-control pull-right material-checkbox">
    </h4>

    <h4 id="property_roughness" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">roughness:</span>
        <input id="roughness-field" type="number" class="form-control pull-right material-input-number" value="0.00">
    </h4>

    <h4 id="property_metalness" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">metalness:</span>
        <input id="metalness-field" type="number" class="form-control pull-right material-input-number" value="0.00">
    </h4>

    <h4 id="property_lightMapIntensity" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">lightMapIntensity:</span>
        <input id="lightMapIntensity-field" type="number" class="form-control pull-right material-input-number" value="0.00">
    </h4>

    <h4 id="property_aoMapIntensity" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">aoMapIntensity:</span>
        <input id="aoMapIntensity-field" type="number" class="form-control pull-right material-input-number" value="0.00">
    </h4>

    <h4 id="property_emissiveIntensity" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">emissiveIntensity:</span>
        <input id="emissiveIntensity-field" type="number" class="form-control pull-right material-input-number" value="0.00">
    </h4>

    <h4 id="property_envMapIntensity" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">envMapIntensity:</span>
        <input id="envMapIntensity-field" type="number" class="form-control pull-right material-input-number" value="0.00">
    </h4>

    <h4 id="property_bumpScale" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">bumpScale:</span>
        <input id="bumpScale-field" type="number" class="form-control pull-right material-input-number" value="0.00">
    </h4>

    <h4 id="property_bumpScale" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">normalScale:</span>
        <input id="normalScale-field" type="number" class="form-control pull-right material-input-number" value="0.00">
    </h4>

    <h4 id="property_displacementScale" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">displacementScale:</span>
        <input id="displacementScale-field" type="number" class="form-control pull-right material-input-number" value="0.00">
    </h4>

    <h4 id="property_displacementBias" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">displacementBias:</span>
        <input id="displacementBias-field" type="number" class="form-control pull-right material-input-number" value="0.00">
    </h4>

    <h4 id="property_refractionRatio" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">refractionRatio:</span>
        <input id="refractionRatio-field" type="number" class="form-control pull-right material-input-number" value="0.00">
    </h4>

    <h4 id="property_wireframe" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">wireframe:</span>
        <input id="wireframe-field" type="checkbox" class="form-control pull-right material-checkbox">
    </h4>

    <h4 id="property_skinning" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">skinning:</span>
        <input id="skinning-field" type="checkbox" class="form-control pull-right material-checkbox">
    </h4>

    <h4 id="property_morphNormals" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">morphNormals:</span>
        <input id="morphNormals-field" type="checkbox" class="form-control pull-right material-checkbox">
    </h4>

    <h4 id="property_morphTargets" class="material-property-controls">
        <span style="vertical-align:-0.7rem;">morphTargets:</span>
        <input id="morphTargets-field" type="checkbox" class="form-control pull-right material-checkbox">
    </h4>



    <h4 id="property_color" class="material-property-controls" style="height:auto!important;">
        <input type="hidden" id="sp-material-color" class="pull-right">
    </h4>

    <script>

        (function (){

            var material;
            $("#sp-material-color").spectrum({
                preferredFormat: "hex",
                color: "#000000",
                flat: true,
                showInput: true,
                showInitial: true,
                showButtons: false,
                allowEmpty: false,
                move: function(color) {
                    if ( !material ) return;
                    var hex = color.toString("hex").replace(/#/, "0x");
                    material.color.setHex(hex);
                }
            });

            $("#sp-material-color").on("dragstop.spectrum", function(e, color) {
                if ( !material ) {
                    $(this).spectrum( "set", "#000000" );
                    return;
                }
            });

            //  Colorpicker update.

            (function (){
                //  var material = viewer.contentWindow[gender][slot].material;
                if ( material ) {
                    var hexString = "#" + material.color.getHexString();
                    $("#sp-material-color").spectrum( "set", hexString );
                }
            })();

        })();

    </script>

    <h4 id="property_emissive" class="material-spectrum-controls" style="height:auto;">
        <input type="hidden" id="sp-material-emissive" class="pull-right">
    </h4>

    <script>

        (function (){

            var material;
            $("#sp-material-emissive").spectrum({
                preferredFormat: "hex",
                color: "#000000",
                flat: true,
                showInput: true,
                showInitial: true,
                showButtons: false,
                allowEmpty: false,
                move: function(color) {
                    if ( !material ) return;
                    var hex = color.toString("hex").replace(/#/, "0x");
                    material.emissive.setHex(hex);
                }
            });

            $("#sp-material-emissive").on("dragstop.spectrum", function(e, color) {
                if ( !material ) {
                    $(this).spectrum( "set", "#000000" );
                    return;
                }
            });

            //  Colorpicker update.

            (function (){
                //  var material = viewer.contentWindow[gender][slot].material;
                if ( material ) {
                    var hexString = "#" + material.emissive.getHexString();
                    $("#sp-material-emissive").spectrum( "set", hexString );
                }
            })();

        })();

    </script>

-->


